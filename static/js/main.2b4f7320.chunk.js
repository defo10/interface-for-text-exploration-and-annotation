(this.webpackJsonpba=this.webpackJsonpba||[]).push([[0],{181:function(e,t,a){},182:function(e,t,a){},192:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a(0),i=a(16),s=a.n(i),o=(a(181),a(41)),l=a(42),c=a(46),d=a(45),u=a(283),h=a(128),b=a(274),m=(a(182),a(20)),v=a.n(m),j=a(38),p=a(54),f=a(29),g=a(8),O=a(23),C=a(47),x=a(15),y=a.n(x),w=a(123),k=a.n(w),S=a(110),_=a(12),z=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).ref=null,n.svg=null,n.group=null,n.scaleTransform=null,n.zoomBehavior=null,n.fillOpacity=.8,n.hoverColor="rgba(245, 124, 0, 1)",n.state={},n}return Object(l.a)(a,[{key:"drawScatterPlot",value:function(){var e=Object(j.a)(v.a.mark((function e(){var t,a,n,r,i,s,o,l,c=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ref){e.next=2;break}return e.abrupt("return");case 2:return t=this.props,a=t.width,n=t.height,r=t.setSelectedDatum,i=t.allCoordinatesAsArray,s=t.selectCluster,o=t.labels,this.svg=this.svg?this.svg:C.b(this.ref),this.group=this.group?this.group:this.svg.append("g"),l=i,e.next=8,this.group.selectAll("circle").data(l,(function(e){return Object(_.a)(e,3)[2]})).join((function(e){return e.append("circle").attr("id",(function(e){return Object(_.a)(e,3)[2]})).attr("cx",(function(e){return Object(_.a)(e,1)[0]})).attr("cy",(function(e){return Object(_.a)(e,2)[1]})).attr("fill-opacity",0).call((function(e){return e.transition().duration(500).delay((function(e,t){return t/c.props.coordinates_to_show*200})).attr("fill-opacity",c.fillOpacity)}))}),(function(e){return e.call((function(e){return e.transition().duration(2e3).attr("cx",(function(e){return Object(_.a)(e,1)[0]})).attr("cy",(function(e){return Object(_.a)(e,2)[1]}))}))}),(function(e){return e.call((function(e){return e.transition().duration(500).delay((function(e,t){return t/c.props.coordinates_to_show*200})).remove().attr("fill-opacity",0)}))})).attr("r",.5).attr("fill","white");case 8:e.sent.on("click",(function(e){var t=parseInt(e.target.id);r(t),s(o[t].label_kmedoids)})),this.zoomBehavior=this.getZoomBehavior(this.group),this.svg.call(this.zoomBehavior),this.svg.call(this.zoomBehavior.transform,this.scaleTransform||this.getInitScale(a,n)),this.props.selectedCluster&&this.updateColorPoints();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getZoomBehavior",value:function(e){var t=this;return C.c().on("zoom",(function(a){var n=a.transform;t.scaleTransform=n,e.attr("transform",n)}))}},{key:"getInitScale",value:function(e,t){var a=Math.min(e/100,t/100);return C.d.scale(a)}},{key:"componentDidMount",value:function(){this.drawScatterPlot()}},{key:"updateColorPoints",value:function(){var e=this,t=this.props,a=t.selected_datum,n=t.labels,r=t.allCoordinatesAsArray;if(this.svg&&n&&this.group){var i=r;if(0===i.length)return this.svg.selectAll("circle").remove();this.group.selectAll("circle").data(i,(function(e){return Object(_.a)(e,3)[2]})).attr("fill",(function(t){var r=Object(_.a)(t,3)[2];return r==a?"cyan":e.props.selectedCluster==n[r].label_kmedoids?e.hoverColor:"white"}))}}},{key:"highlightSearchResults",value:function(){var e=this;if(this.svg&&this.group){var t=this.props,a=t.allCoordinatesAsArray,n=t.searchResultIndices,r=a;if(0===r.length)return this.group.selectAll("circle").remove();this.group.selectAll("circle").data(r,(function(e){return Object(_.a)(e,3)[2]})).attr("fill",(function(t){var a=Object(_.a)(t,3)[2];return n[a]?e.hoverColor:"white"}))}}},{key:"showHoveredComment",value:function(){var e=this.props,t=e.labels,a=e.allCoordinatesAsArray,n=e.hoveredCommentCoordinate;if(this.svg&&t&&this.group){var r=a;if(0===r.length)return this.group.selectAll("circle").remove();n&&r.push([null===n||void 0===n?void 0:n.x,null===n||void 0===n?void 0:n.y,null===n||void 0===n?void 0:n.index]),this.group.selectAll("circle").data(r,(function(e){return Object(_.a)(e,3)[2]})).join((function(e){return e.append("circle").attr("fill","cyan").attr("fill-opacity","1").attr("r",1).attr("id",(function(e){return Object(_.a)(e,3)[2]})).attr("cx",(function(e){return Object(_.a)(e,1)[0]})).attr("cy",(function(e){return Object(_.a)(e,2)[1]}))}))}}},{key:"zoomAroundCluster",value:function(){var e,t,a,n,r,i,s,o,l=this;if(this.zoomBehavior&&this.svg)if(this.props.selectedCluster){var c=this.props.coordinatesParameters.numNeighborsParameter,d=this.props.coordinatesParameters.minDistParameter;if(null===(e=this.props.allCoordinatesFull)||void 0===e||null===(t=e[c])||void 0===t?void 0:t[d]){var u=null===(a=this.props.labels)||void 0===a?void 0:a.filter((function(e){return e.label_kmedoids===l.props.selectedCluster})).map((function(e,t){var a,n,r;return null===(a=l.props.allCoordinatesFull)||void 0===a||null===(n=a[c])||void 0===n||null===(r=n[d])||void 0===r?void 0:r[t]})),h=y.a.meanBy(u,"x")||15,b=y.a.meanBy(u,"y")||15,m=(null===(n=y.a.maxBy(u,"x"))||void 0===n?void 0:n.x)||0-((null===(r=y.a.minBy(u,"x"))||void 0===r?void 0:r.x)||0),v=(null===(i=y.a.maxBy(u,"y"))||void 0===i?void 0:i.y)||0-((null===(s=y.a.minBy(u,"y"))||void 0===s?void 0:s.y)||0),j=Math.min(this.props.width/m,this.props.height/v);null===(o=this.svg)||void 0===o||o.transition().duration(500).call(this.zoomBehavior.translateTo,h,b).transition().duration(500).call(this.zoomBehavior.scaleTo,1.3*j)}}else{var p,f=this.getInitScale(this.props.width,this.props.height);null===(p=this.svg)||void 0===p||p.transition().duration(1e3).call(this.zoomBehavior.transform,C.d.scale(f.k))}}},{key:"hasCommentClickedOnChanged",value:function(e){return e.selected_datum!==this.props.selected_datum}},{key:"haveCoordinatesChanged",value:function(e){return!y.a.isEqual(y.a.sortBy(e.allCoordinates),y.a.sortBy(this.props.allCoordinates))}},{key:"haveSearchResultsChanged",value:function(e){return e.searchResultIndices!==this.props.searchResultIndices}},{key:"haveClustersToShowChanged",value:function(e){return!y.a.isEqual(y.a.sortBy(e.clustersToShow),y.a.sortBy(this.props.clustersToShow))}},{key:"hasSelectedClusterChanged",value:function(e){return e.selectedCluster!==this.props.selectedCluster}},{key:"hasHoveredCommentCoordinateChanged",value:function(e){var t,a;return(null===(t=e.hoveredCommentCoordinate)||void 0===t?void 0:t.index)!==(null===(a=this.props.hoveredCommentCoordinate)||void 0===a?void 0:a.index)}},{key:"componentDidUpdate",value:function(e,t){if(this.hasCommentClickedOnChanged(e))this.updateColorPoints();else{if(this.hasSelectedClusterChanged(e))return this.drawScatterPlot(),void this.zoomAroundCluster();if(!this.haveClustersToShowChanged(e)&&!this.haveCoordinatesChanged(e))return this.haveSearchResultsChanged(e)?this.highlightSearchResults():this.hasHoveredCommentCoordinateChanged(e)?this.showHoveredComment():void 0;this.drawScatterPlot()}}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,r=t.height;return Object(n.jsx)("svg",{ref:function(t){e.ref=t},width:a,height:r,overflow:"hidden"})}}]),a}(r.Component),P=a(245),N=a(75),L=a(249),A=a(284),T=a(248),M=a(74),R=a.n(M),D=Object(P.a)((function(e){return{margin:{height:e.spacing(3)},slider:{color:e.palette.text.primary,minWidth:"14em"},tooltip:{fontSize:"0.8em"}}})),I=[{value:2,label:"2"},{value:5,label:"5"},{value:10,label:"10"},{value:50,label:"50"}],B=[{value:1,label:"0.1"},{value:2,label:"0.2"},{value:5,label:"0.5"},{value:9,label:"0.9"}];function F(e){var t=D(),a=e.coordinatesParameters.numNeighborsParameter,r=e.coordinatesParameters.minDistParameter;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("div",{style:{flex:"2 auto",padding:"0 16px",display:"inline"},children:[Object(n.jsxs)("div",{children:[Object(n.jsx)(N.a,{variant:"subtitle2",gutterBottom:!0,style:{display:"inline"},children:"Number of neighbors"}),Object(n.jsx)(T.a,{title:"The size of local neighborhood (in terms of number of neighboring sample points) used for manifold approximation. Larger values result in more global views of the manifold, while smaller values result in more local data being preserved.",placement:"top",classes:{tooltip:t.tooltip},children:Object(n.jsx)(R.a,{style:{marginLeft:"8px",fontSize:"1em"}})})]}),Object(n.jsx)(A.a,{getAriaValueText:function(e){return"".concat(e)},"aria-labelledby":"number of neighbors for underyling umap algorithm",step:null,marks:I,min:2,max:50,value:parseInt(a),onChange:function(t,a){e.coordinatesParameters.numNeighborsParameter!=="".concat(a)&&e.setSelectedCoordinates("".concat(a),r)},className:t.slider})]}),Object(n.jsxs)("div",{style:{flex:"2 auto",padding:"0 16px"},children:[Object(n.jsxs)("div",{children:[Object(n.jsx)(N.a,{variant:"subtitle2",gutterBottom:!0,style:{display:"inline"},children:"Minimum distance between points"}),Object(n.jsx)(T.a,{title:"The effective minimum distance between embedded points. Smaller values will result in a more clustered/clumped embedding where nearby points on the manifold are drawn closer together, while larger values will result on a more even dispersal of points.",placement:"top",classes:{tooltip:t.tooltip},children:Object(n.jsx)(R.a,{style:{marginLeft:"8px",fontSize:"1em"}})})]}),Object(n.jsx)(A.a,{getAriaValueText:function(e){return"".concat(e)},"aria-labelledby":"number of mininum distances for underyling umap algorithm",step:null,marks:B,min:1,max:9,value:parseInt(r.split(".")[1]),onChange:function(t,n){e.coordinatesParameters.minDistParameter!=="0.".concat(n)&&e.setSelectedCoordinates(a,"0.".concat(n))},className:t.slider})]})]})}var H=a(125),q=Object(P.a)((function(e){return{absoluteContainer:{position:"absolute",margin:"0 ".concat(e.spacing(1)),bottom:e.spacing(2),opacity:function(e){return e.isMouseOver?1:.2},transition:"opacity 0.1s",display:"flex",flexWrap:"wrap",width:"100%"}}}));function E(e){var t=Object(r.useState)(!1),a=Object(_.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(500),l=Object(_.a)(o,2),c=l[0],d=l[1],u=q({width:e.width,isMouseOver:i});return Object(n.jsxs)("div",{className:u.absoluteContainer,onMouseEnter:function(){return s(!0)},onMouseLeave:function(){return s(!1)},children:[Object(n.jsx)(F,Object(g.a)({},e)),Object(n.jsxs)("div",{style:{padding:"0 16px"},children:[Object(n.jsx)(N.a,{variant:"subtitle2",style:{display:"inline",paddingRight:"16px"},children:"Sample Size of Comments to Visualize"}),Object(n.jsxs)(H.a,{value:c,onChange:function(t){var a=parseInt(t.target.value)||0;d(a),e.reloadCoordinatesWithSize(a)},children:[Object(n.jsx)("option",{value:500,children:"500"}),Object(n.jsx)("option",{value:1e3,children:"1000"}),Object(n.jsx)("option",{value:2e3,children:"2000 (slow)"})]}),e.coordsAreReloading&&Object(n.jsx)(L.a,{style:{display:"inline-block",marginLeft:"8px"},size:"1em"})]})]})}var W=a(96),U=a(62),J=a(276),K=a(130),V=a(254),G=a(255),Z=a(252),$=a(253),Q=a(250),X=a(277),Y=a(251),ee=a(285),te=[];function ae(e,t,a){return t[a]<e[a]?-1:t[a]>e[a]?1:0}var ne=Object(P.a)((function(e){return{tootltip:{fontSize:"0.8em"}}}));function re(e){var t=e.classes,a=e.onSelectAllClick,r=e.order,i=e.orderBy,s=e.numSelected,o=e.rowCount,l=e.onRequestSort,c=ne();return Object(n.jsx)(Q.a,{children:Object(n.jsxs)(Y.a,{children:[Object(n.jsx)(Z.a,{padding:"checkbox",children:Object(n.jsx)(J.a,{indeterminate:s>0&&s<o,checked:o>0&&s===o,onChange:a,inputProps:{"aria-label":"show all clusters"}})}),[{id:"label",numeric:!1,disablePadding:!0,label:"Cluster Name"},{id:"size",numeric:!0,disablePadding:!1,label:"Size (in\xa0%)"},{id:"metric",numeric:!0,disablePadding:!1,label:"Density",sublabel:"Density describes how close comments of the same cluster lie together, with 0 being the densest cluster and 1 being the farthest spread out cluster."}].map((function(e){return Object(n.jsx)(Z.a,{align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:i===e.id&&r,children:Object(n.jsxs)(ee.a,{active:i===e.id,direction:i===e.id?r:"asc",onClick:(a=e.id,function(e){l(e,a)}),children:[e.sublabel&&Object(n.jsx)(T.a,{title:e.sublabel,placement:"bottom-end",classes:{tooltip:c.tootltip},children:Object(n.jsx)(R.a,{style:{marginLeft:"8px",fontSize:"1em"}})}),Object(n.jsx)(N.a,{style:{fontWeight:600},children:e.label}),i===e.id?Object(n.jsx)("span",{className:t.visuallyHidden,children:"desc"===r?"sorted descending":"sorted ascending"}):null]})},e.id);var a}))]})})}var ie=Object(P.a)((function(e){return{paper:{color:"white",backgroundColor:"unset",width:"100%",marginBottom:e.spacing(2)},table:{color:"white"},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1}}})),se=Object(P.a)((function(e){return{spacer:{flex:"1"},actions:{marginLeft:"0",marginRight:"0"},input:{flex:"1 3 100%",marginLeft:"0",marginRight:"0"},caption:{flex:"1 1 100%"}}}));function oe(e,t){var a=[];for(var n in e){var r=(100*e[n].size/t).toFixed(1);a.push({label:n,size:e[n].size,metric:e[n].quality.toFixed(2),sizePrct:r})}return a}function le(e){var t=e.labels,a=e.data,i=(e.dataChanged,e.clustersToShow),s=e.setClustersToShow,o=e.selectCluster,l=e.setSelectedDatum,c=e.selectedCluster,d=Object(U.a)(e,["labels","data","dataChanged","clustersToShow","setClustersToShow","selectCluster","setSelectedDatum","selectedCluster"]),u=ie(),h=se(),b=Object(r.useState)("desc"),m=Object(_.a)(b,2),v=m[0],j=m[1],p=Object(r.useState)("size"),f=Object(_.a)(p,2),g=f[0],O=f[1],C=Object(r.useState)(0),x=Object(_.a)(C,2),y=x[0],w=x[1],k=Object(r.useState)(10),S=Object(_.a)(k,2),z=S[0],P=S[1];te=oe(d.clusters,(null===t||void 0===t?void 0:t.length)||0);var N=function(e,t){var a=e.map((function(e,t){return[e,t]}));return a.sort((function(e,a){var n=t(e[0],a[0]);return 0!==n?n:e[1]-a[1]})),a.map((function(e){return e[0]}))}(te,function(e,t){return"desc"===e?function(e,a){return ae(e,a,t)}:function(e,a){return-ae(e,a,t)}}(v,g));return Object(r.useEffect)((function(){te=oe(d.clusters,(null===a||void 0===a?void 0:a.length)||0)}),[d.clusters,a]),Object(n.jsx)("div",{children:Object(n.jsxs)(K.a,{className:u.paper,children:[Object(n.jsx)($.a,{children:Object(n.jsxs)(V.a,{style:{width:"100%",minWidth:"auto"},className:u.table,"aria-labelledby":"tableTitle",size:"medium","aria-label":"cluster table",children:[Object(n.jsx)(re,{classes:u,numSelected:i.length,order:v,orderBy:g,onSelectAllClick:function(e){if(e.target.checked){var t=te.map((function(e){return e.label}));s(t)}else s([])},onRequestSort:function(e,t){j(g===t&&"asc"===v?"desc":"asc"),O(t)},rowCount:te.length}),Object(n.jsx)(G.a,{children:N.slice(y*z,y*z+z).map((function(e,t){var a,r,u=(r=e.label,-1!==i.indexOf(r)),h="enhanced-table-checkbox-".concat(t);return Object(n.jsxs)(Y.a,{hover:!0,onClick:function(t){return function(e,t){if("INPUT"!==e.target.nodeName){c!==t&&(l(null),o(t));var a=[];-1===i.indexOf(t)&&(a=a.concat(i,t),s(a))}}(t,e.label)},role:"checkbox","aria-checked":u,tabIndex:-1,selected:u,style:c===e.label?{backgroundColor:"rgba(245, 124, 0, 0.7)"}:{},children:[Object(n.jsx)(Z.a,{padding:"checkbox",children:Object(n.jsx)(J.a,{color:"secondary",checked:u,inputProps:{"aria-labelledby":h},onClick:function(t){return function(e,t){var a=i.indexOf(t),n=[];-1===a?n=n.concat(i,t):0===a?n=n.concat(i.slice(1)):a===i.length-1?n=n.concat(i.slice(0,-1)):a>0&&(n=n.concat(i.slice(0,a),i.slice(a+1))),s(n)}(0,e.label)}})}),Object(n.jsx)(Z.a,{component:"th",id:h,scope:"row",padding:"none",children:c===e.label?null===(a=d.changedClusterName)||void 0===a?void 0:a.changed:e.label}),Object(n.jsx)(Z.a,{align:"right",children:"".concat(e.size," (").concat(e.sizePrct,")")}),Object(n.jsx)(Z.a,{align:"right",children:e.metric})]},e.label)}))})]})}),Object(n.jsx)(X.a,{classes:h,rowsPerPageOptions:[10,20,45],component:"div",count:te.length,rowsPerPage:z,page:y,onChangePage:function(e,t){w(t)},onChangeRowsPerPage:function(e){P(parseInt(e.target.value,10)),w(0)}})]})})}var ce=a(280),de=a(261),ue=a(275),he=Object(P.a)((function(e){return{horizontalContainer:{paddingRight:e.spacing(3),paddingLeft:e.spacing(3),paddingTop:"1em",paddingBottom:"1em",width:"auto",height:"auto"},rightAlign:{display:"block",marginLeft:"auto",marginRight:"0"},gridContainer:{display:"grid",gridTemplateColumns:"9fr 1fr",gridRowGap:e.spacing(1)}}}));function be(e){var t,a=he(),i=Object(r.useState)("New Cluster Name"),s=Object(_.a)(i,2),o=s[0],l=s[1],c=Object(r.useState)(null),d=Object(_.a)(c,2),u=d[0],h=d[1],b=Object(r.useState)(null),m=Object(_.a)(b,2),v=m[0],j=m[1],f=Array.from(new Set(null===(t=e.labels)||void 0===t?void 0:t.map((function(e){return e.label_kmedoids})))),O=function(t){var a;return(null===(a=e.clustersToShow)||void 0===a?void 0:a.includes(t))?"Visible Clusters":"Other Clusters"},C=function(e,t){var a=O(e),n=O(t);return a<n?1:a===n?0:-1};return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("div",{className:a.gridContainer,children:[Object(n.jsx)(ue.a,{options:f.filter((function(e){return e!=v})).sort(C),groupBy:O,renderInput:function(e){return Object(n.jsx)(ce.a,Object(g.a)(Object(g.a)({},e),{},{label:"First",variant:"outlined"}))},onChange:function(e,t){return h(t)},value:u}),Object(n.jsx)("p",{style:{textAlign:"center"},children:"+"}),Object(n.jsx)(ue.a,{options:f.filter((function(e){return e!=u})).sort(C),groupBy:O,renderInput:function(e){return Object(n.jsx)(ce.a,Object(g.a)(Object(g.a)({},e),{},{label:"Second",variant:"outlined"}))},onChange:function(e,t){return j(t)},value:v}),Object(n.jsx)("p",{style:{textAlign:"center"},children:"="}),Object(n.jsx)(ce.a,{variant:"outlined",value:o,onChange:function(e){return l(e.target.value)}})]}),Object(n.jsx)("div",{className:a.horizontalContainer,children:Object(n.jsx)(de.a,{className:a.rightAlign,variant:"contained",color:"primary",onClick:function(){u&&v&&(e.renameLabels([u,v],o),e.setSelectedDatum(null),e.selectCluster(o),e.clustersToShow.includes(o)||e.setClustersToShow([].concat(Object(p.a)(e.clustersToShow),[o])),h(null),j(null))},disabled:!(u&&v),children:"Merge"})})]})}var me=a(262),ve=a(281),je=a(264),pe=a(266),fe=a(265),ge=a(263),Oe=Object(P.a)((function(e){return{padding:{padding:e.spacing(2)},marginCard:{marginLeft:e.spacing(2),marginRight:e.spacing(2),marginBottom:e.spacing(3)},rightMargin:{marginRight:e.spacing(2)},root:{margin:e.spacing(2)},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary},tootltip:{fontSize:"0.8em"}}}));function Ce(e){var t,a,i,s=Oe(),o="Click to expand",l=Object(r.useState)(o),c=Object(_.a)(l,2),d=c[0],u=c[1],h=Object(n.jsx)(me.a,{variant:"outlined",className:s.marginCard,children:Object(n.jsxs)(ge.a,{children:[Object(n.jsx)(N.a,{variant:"body1",gutterBottom:!0,children:"Comments in total: ".concat((null===(t=e.labels)||void 0===t?void 0:t.length)||"undefined")}),Object(n.jsx)(N.a,{variant:"body1",children:"Number of clusters: ".concat(Object.keys(e.clusters).length||"undefined")})]})}),b=Object(n.jsx)(T.a,{title:"This is a list of all clusters. Grey entries (checked checkbox) are currently visible in the visualization. The cluster seen in the details pane (right) is highlighted orange.",placement:"bottom-end",classes:{tooltip:s.tootltip},children:Object(n.jsx)(N.a,{align:"right",variant:"subtitle2",className:s.rightMargin,children:"What am I seeing here?"})});return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(ve.a,{className:s.root,onChange:function(){u(d===o?"Click to minimize":o)},children:[Object(n.jsxs)(je.a,{expandIcon:Object(n.jsx)(fe.a,{}),"aria-controls":"cluster merger",id:"cluster merger",children:[Object(n.jsx)(N.a,{className:s.heading,children:"Merge Clusters"}),Object(n.jsx)(N.a,{className:s.secondaryHeading,children:d})]}),Object(n.jsx)(pe.a,{style:{display:"block"},children:Object(n.jsx)(be,Object(g.a)({},e))})]}),(a="Clusters Overview",i="Browse all clusters.",Object(n.jsxs)("div",{className:s.padding,children:[Object(n.jsx)(N.a,{variant:"h5",children:a}),i&&Object(n.jsx)(N.a,{variant:"body2",children:i})]})),h,b,Object(n.jsx)(le,Object(g.a)({},e))]})}var xe=Object(W.a)({sidebarContainerLeft:{width:"100%",height:"100vh",overflow:"scroll"}});function ye(e){var t=xe();return Object(n.jsx)("div",{className:t.sidebarContainerLeft,children:Object(n.jsx)("div",{style:{overflow:"scroll"},children:Object(n.jsx)(Ce,Object(g.a)({},e))})})}var we=a(267),ke=a(257),Se=Object(P.a)((function(e){return{root:{flexGrow:1},menuButton:{color:"white",marginLeft:e.spacing(2)},title:{flexGrow:1},colorPrimary:{backgroundColor:"rgba(245, 124, 0, 0.7)"}}}));function _e(e){var t=Se();return Object(n.jsx)(we.a,{position:"relative",color:"primary",classes:{colorPrimary:t.colorPrimary},children:Object(n.jsx)(ke.a,{style:{marginTop:"8px"},children:Object(n.jsx)(ce.a,{inputProps:{style:{fontSize:"1.5em",fontWeight:600,padding:"8px"}},variant:"outlined",label:"Change Cluster Name",value:e.labelLocal,onChange:function(t){return e.setLabelLocal(t.target.value)}})})})}var ze=a(271),Pe=a(287),Ne=a(259),Le=a(256),Ae=a(270),Te=a(269),Me=a(268),Re=a(282),De=a(127),Ie=a.n(De),Be=a(260);function Fe(e){var t,a,r=e.open,i=(e.data,e.labels),s=e.clustersToShow,o=e.clusters,l=(e.onClose,e.i),c=e.selectedCluster,d=e.onMoveCluster,u=(Object(U.a)(e,["open","data","labels","clustersToShow","clusters","onClose","i","selectedCluster","onMoveCluster"]),y.a.without.apply(y.a,[Object.keys(o)].concat(Object(p.a)(s))));return Object(n.jsxs)(Re.a,{onClose:function(){return d(null,l)},"aria-labelledby":"dialog for changing the cluster of the selected comment",open:r,children:[Object(n.jsx)(Me.a,{children:"Change Cluster"}),Object(n.jsxs)(Ne.a,{children:[Object(n.jsx)(Be.a,{component:"div",id:"nested-list-subheader",disableSticky:!0,children:"Selected Cluster"}),Object(n.jsx)(Le.a,{onClick:function(){return d(c,l)},button:!0,children:Object(n.jsx)(Te.a,{primary:c,secondary:"size: ".concat(null===(t=o[c||""])||void 0===t?void 0:t.size,"    density: ").concat(null===(a=o[c||""])||void 0===a?void 0:a.quality.toFixed(3))})},"clusterpicker-".concat(-1)),Object(n.jsx)(Be.a,{component:"div",id:"nested-list-subheader",disableSticky:!0,children:"Visible Clusters"}),s.map((function(e){var t,a;if(e!==i[l].label_kmedoids)return Object(n.jsx)(Le.a,{onClick:function(){return d(e,l)},button:!0,children:Object(n.jsx)(Te.a,{primary:e,secondary:"size: ".concat((null===(t=o[e])||void 0===t?void 0:t.size)||"N/A","    density: ").concat((null===(a=o[e])||void 0===a?void 0:a.quality.toFixed(3))||"N/A")})},"clusterpicker-".concat(e))})),Object(n.jsx)(Be.a,{component:"div",id:"nested-list-subheader",disableSticky:!0,children:"Other Clusters"}),u.map((function(e){return Object(n.jsx)(Le.a,{onClick:function(){return d(e,l)},button:!0,children:Object(n.jsx)(Te.a,{primary:e,secondary:"size: ".concat(o[e].size,"    density: ").concat(o[e].quality.toFixed(3))})},"clusterpicker-".concat(e))})),Object(n.jsxs)(Le.a,{onClick:function(){return d("new",l)},autoFocus:!0,button:!0,children:[Object(n.jsx)(Ae.a,{children:Object(n.jsx)(Pe.a,{children:Object(n.jsx)(Ie.a,{})})}),Object(n.jsx)(Te.a,{primary:"Add to new Cluster",secondary:'The name of the new cluster is "new" by default'})]})]})]})}var He=Object(P.a)((function(e){return{styleContainer:function(t){return{display:"block",marginLeft:0,marginRight:0,marginBottom:e.spacing(1),backgroundColor:t.backgroundColor,borderRadius:0}},styleMetaInfos:{display:"block",width:"100%",height:"auto"},styleUsername:{display:"inline",fontWeight:"bold",wordBreak:"break-word"},styleComment:{marginBottom:"0",marginTop:"8px",wordBreak:"break-word"},styleDate:{marginLeft:"8px",display:"inline",color:"LightGray",fontStyle:"italic",fontSize:"0.9em"},btnsContainer:{maxHeight:0,overflow:"hidden",transitionDelay:"0.2s",transition:"max-height 0.3s",paddingRight:e.spacing(3),paddingLeft:e.spacing(3),width:"100%"},rightAlign:{display:"block",marginLeft:"auto",marginRight:"0"},tooltip:{fontSize:"0.8em"}}})),qe=Object(P.a)((function(e){return{root:{paddingTop:8,paddingBottom:0,paddingLeft:16,paddingRight:16}}}));function Ee(e){e.dense;var t=e.data,a=e.i,i=e.onMoveCluster,s=e.added,o=void 0!==s&&s,l=e.removed,c=void 0!==l&&l,d=e.isRepresentative,u=void 0!==d&&d,h=Object(U.a)(e,["dense","data","i","onMoveCluster","added","removed","isRepresentative"]),b=He({backgroundColor:o?"#1d3d17":c?"#3d171b":"auto"}),m=qe(),v=t[a],j=v.publishedAt,p=v.authorName,f=v.cleaned,O=Object(r.useState)(!1),C=Object(_.a)(O,2),x=C[0],w=C[1],k=y.a.find(h.dataChanged,["i",a]);return Object(n.jsxs)(me.a,{onMouseEnter:function(e){h.setHoveredCommentCoordinate(a)},onMouseLeave:function(e){h.setHoveredCommentCoordinate(null)},className:b.styleContainer,children:[Object(n.jsxs)(ge.a,{classes:m,children:[k&&Object(n.jsx)("p",{style:{marginLeft:0},className:b.styleDate,children:"from cluster ".concat(null===k||void 0===k?void 0:k.oldLabel.label_kmedoids," to ").concat(null===k||void 0===k?void 0:k.newLabel.label_kmedoids)}),Object(n.jsxs)("div",{className:b.styleMetaInfos,children:[Object(n.jsx)("p",{className:b.styleUsername,children:p}),Object(n.jsx)("p",{className:b.styleDate,children:j})]}),Object(n.jsx)("p",{className:b.styleComment,children:f})]}),Object(n.jsx)(ze.a,{children:u?Object(n.jsx)(T.a,{classes:{tooltip:b.tootltip},title:"As this comment represents the whole cluster, it may not be moved. Use the Merge Clusters Field to merge the whole cluster with another.",children:Object(n.jsx)("span",{children:Object(n.jsx)(de.a,{onClick:function(){return null},disabled:!0,children:"Move to other Cluster"})})}):Object(n.jsx)(de.a,{onClick:function(){return w(!0)},children:"Move to other Cluster"})}),Object(n.jsx)(Fe,Object(g.a)({open:x,onMoveCluster:function(e){w(!1),i(e,a)},i:a,data:t},h))]})}var We=a(272),Ue=a(273),Je=Object(P.a)((function(e){return{inline:{display:"inline"},secondaryAction:{paddingRight:"80px"}}}));function Ke(e){var t=Je(),a=Object(r.useState)(!1),i=Object(_.a)(a,2),s=i[0],o=i[1];return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(Le.a,{classes:{secondaryAction:t.secondaryAction},children:[Object(n.jsx)(Te.a,{onMouseEnter:function(t){e.setHoveredCommentCoordinate(e.i)},onMouseLeave:function(t){e.setHoveredCommentCoordinate(null)},primary:e.d.authorName,secondary:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(N.a,{component:"span",variant:"body2",className:t.inline,style:{wordBreak:"break-word"},children:"".concat(e.d.publishedAt," - ")}),Object(n.jsx)(N.a,{component:"span",variant:"body2",color:"textPrimary",style:{wordBreak:"break-word"},children:e.d.cleaned})]})}),Object(n.jsx)(We.a,{children:Object(n.jsx)(de.a,{onClick:function(){return o(!0)},children:"Move"})})]},e.d.i),Object(n.jsx)(Ue.a,{}),Object(n.jsx)(Fe,Object(g.a)(Object(g.a)({},e),{},{open:s,onMoveCluster:function(t){o(!1),e.onMoveCluster(t,e.i)},i:e.i,data:e.data}))]})}var Ve=Object(P.a)((function(e){return{padding:{padding:e.spacing(2)},coverSidebar:{position:"relative",width:"100%",height:"100vh",overflow:"scroll",transition:"all 0.3s",backgroundColor:"#222"},root:{width:"100%"}}})),Ge="",Ze="";function $e(e){var t,a,i=e.data,s=e.dataChanged,o=e.pushToDataChanged,l=e.labels,c=e.selected_datum,d=e.selectedCluster,u=Ve(),h=Object(r.useRef)(null),b=Object(r.useState)(d||""),m=Object(_.a)(b,2),v=m[0],j=m[1],p=i.filter((function(e,t){if(null===l)return!1;var a=y.a.find(s,["i",e.i]),n=t===c,r=l[t].label_kmedoids==d;return!a&&r&&!n})),f=s.filter((function(e){return e.newLabel.label_kmedoids===d})),O=s.filter((function(e){return e.oldLabel.label_kmedoids===d}));Object(r.useEffect)((function(){d&&Ge&&Ge!=Ze&&e.renameLabels([Ge],Ze),Ze=v,Ge=d}),[d]),Object(r.useEffect)((function(){h.current&&h.current.scrollIntoView({behavior:"smooth"})}),[c]);var C=function(e,t){e&&l&&o(Object(g.a)(Object(g.a)({},i[t]),{},{oldLabel:l[t],newLabel:{label_kmedoids:e}}))},x=function(t,a){return t.map((function(t,r){if(!(r>20))return Object(n.jsx)(Ee,Object(g.a)(Object(g.a)(Object(g.a)({onMoveCluster:C,i:t.i},"added"===a?{added:!0}:"removed"===a?{removed:!0}:{}),e),{},{dense:!0}),"cluster-peer-".concat(r))}))},w=function(e,t){return Object(n.jsxs)("div",{className:u.padding,children:[Object(n.jsx)(N.a,{variant:"h5",children:e}),t&&Object(n.jsx)(N.a,{variant:"body2",children:t})]})},k=e.selectedCluster&&(null===(t=e.clusters[e.selectedCluster])||void 0===t?void 0:t.medoid),S=e.selectedCluster&&(null===(a=e.clusters[e.selectedCluster])||void 0===a?void 0:a.representatives.length)>0;return d?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("div",{ref:h}),Object(n.jsx)(_e,Object(g.a)({labelLocal:v,setLabelLocal:function(t){Ze=t,j(t),e.setChangedClusterName({original:e.selectedCluster,changed:t})}},e)),0!=f.length&&w("Added to this Cluster","Here are all comments added to this cluster from another by you in this cycle."),0!=f.length&&x(f,"added"),0!=O.length&&w("Removed from this Cluster","Here are all comments removed from this cluster by you in this cycle."),0!=O.length&&x(O,"removed"),c&&Object(n.jsxs)(n.Fragment,{children:[w("Selected Comment","The comment of the point clicked on."),Object(n.jsx)(Ee,Object(g.a)({onMoveCluster:C,i:c},e))]}),k&&w("Cluster Representative","The comment best representing all other comments of this cluster."),k&&Object(n.jsx)(Ee,Object(g.a)({onMoveCluster:C,isRepresentative:!0,i:e.clusters[e.selectedCluster].medoid||0},e)),S&&w("Overview Comments","Distinct comments of this cluster, representing different sub-topics of this cluster."),S&&e.clusters[e.selectedCluster].representatives.map((function(t){return Object(n.jsx)(Ee,Object(g.a)({onMoveCluster:C,i:t},e),"representative-".concat(t))})),w("Other Comments","A sample of other comments of this cluster."),Object(n.jsx)(Ne.a,{className:u.root,children:p.slice(0,20).map((function(t){return Object(n.jsx)(Ke,Object(g.a)({d:t,i:t.i,onMoveCluster:C},e),"list comment ".concat(t.i))}))})]}):Object(n.jsx)("div",{className:u.coverSidebar,style:{display:"flex",justifyContent:"center",alignItems:"center"},children:Object(n.jsx)(N.a,{style:{padding:16},children:"Click on a point or on a cluster in the left panel to see its details here!"})})}function Qe(e){return Object(n.jsx)($e,Object(g.a)({},e))}var Xe=Object(W.a)({sidebarContainer:{width:"100%",height:"100vh",overflow:"hidden",display:"block"},coverSidebar:{position:"relative",width:"100%",height:"100vh",overflow:"scroll",transition:"all 0.3s",backgroundColor:"#222"}});function Ye(e){var t=Xe();return Object(n.jsx)("div",{className:t.sidebarContainer,children:Object(n.jsx)("div",{className:t.coverSidebar,children:Object(r.createElement)(Qe,Object(g.a)(Object(g.a)({},e),{},{key:"".concat(e.selectedCluster)}))})})}var et=350,tt=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).sidebar_ctx=void 0,n.sidebar_mount=null,n.state={ww:null,wh:null,sidebar_height:null,sidebar_width:null,svg_width:null,selected_datum:null,searchInput:"",searchResultIndices:{},selectedCluster:null,svgKey:"1"},n.sidebar_ctx=null,n.setSize=x.debounce(n.setSize.bind(Object(O.a)(n)),200),n.setSelectedDatum=n.setSelectedDatum.bind(Object(O.a)(n)),n.updateSearchResultIndices=n.updateSearchResultIndices.bind(Object(O.a)(n)),n.selectCluster=n.selectCluster.bind(Object(O.a)(n)),n}return Object(l.a)(a,[{key:"selectCluster",value:function(e){this.setState({selectedCluster:e}),this.props.setChangedClusterName({original:e,changed:e})}},{key:"setSize",value:function(){var e,t=(null===(e=this.sidebar_mount)||void 0===e?void 0:e.offsetHeight)||0,a=x.max([window.innerWidth/4||350,350])||350,n=x.min([window.innerWidth-700,.5*window.innerWidth])||window.innerWidth-700;this.setState({sidebar_height:t,sidebar_width:a,svg_width:n,ww:window.innerWidth,wh:window.innerHeight})}},{key:"UNSAFE_componentWillMount",value:function(){this.setSize()}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.setSize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setSize)}},{key:"haveEmbeddingsChanged",value:function(e){return e.embeddings!==this.props.embeddings||e.embeddings.length!==this.props.embeddings.length}},{key:"setSelectedDatum",value:function(e){this.props.labels&&this.setState({selected_datum:e,selectedCluster:e?this.props.labels[e].label_kmedoids:null})}},{key:"updateSearchResultIndices",value:function(e){var t;if(!(e.length<1)){var a=null===(t=this.props.searchIndex)||void 0===t?void 0:t.search(e),n=null===a||void 0===a?void 0:a.map((function(e,t){return[e.ref,t]}));this.setState({searchInput:e,searchResultIndices:Object.fromEntries(n),selected_datum:null})}}},{key:"render",value:function(){var e=this,t=this.sidebar_ctx,a={height:this.state.wh,overflow:"auto",background:"#222",display:"flex",flexDirection:"column"},r={position:"inline-block",height:this.state.wh,background:"#111",overflow:"hidden"},i=Object(g.a)(Object(g.a)(Object(g.a)({},this.props),this.state),{},{setSelectedDatum:this.setSelectedDatum,selectCluster:this.selectCluster,sidebar_orientation:"vertical"}),s=this.props.allCoordinates.filter((function(t){var a;return e.props.clustersToShow.includes((null===(a=e.props.labels)||void 0===a?void 0:a[t.index].label_kmedoids)||"")})).map((function(e){return[e.x,e.y,e.index]})),o=Object(g.a)(Object(g.a)({},this.props),{},{width:this.state.svg_width||0,height:r.height,sidebar_ctx:t,selectedCluster:this.state.selectedCluster,setSelectedDatum:this.setSelectedDatum,selected_datum:this.state.selected_datum,searchResultIndices:this.state.searchResultIndices,selectCluster:this.selectCluster,allCoordinatesAsArray:s});return null!==this.state.ww?Object(n.jsxs)(S.a,{split:"vertical",minSize:et,maxSize:700,defaultSize:this.state.sidebar_width||et,onChange:function(t){e.setState({sidebar_width:t+8,svgKey:"".concat(parseInt(e.state.svgKey)+1)})},children:[Object(n.jsx)("div",{style:a,ref:function(t){e.sidebar_mount=t},children:Object(n.jsx)(ye,Object(g.a)({},i))}),Object(n.jsxs)(S.a,{split:"vertical",minSize:400,defaultSize:this.state.svg_width||400,maxSize:this.state.ww-700,onChange:function(t){e.setState({svg_width:t,svgKey:"".concat(parseInt(e.state.svgKey)+1)})},children:[Object(n.jsxs)("div",{style:r,children:[Object(n.jsx)(E,Object(g.a)({},o)),Object(n.jsx)(z,Object(g.a)({},o),this.state.svgKey)]}),Object(n.jsx)("div",{style:a,children:Object(n.jsx)(Ye,Object(g.a)({},i))})]})]}):Object(n.jsx)("div",{style:{padding:"1rem"},children:"Loading layout..."})}}]),a}(r.Component),at=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).random_indices=null,n.state={allCoordinatesFull:null,allCoordinates:null,coordsAreReloading:!1,coordinatesParameters:{numNeighborsParameter:"10",minDistParameter:"0.1"},coordinates_to_show:500,data:null,labels:null,searchIndex:null,clustersToShow:Array.from(Array(40).keys()).map((function(e){return"cluster ".concat(e)})),clusters:{},dataChanged:[],hoveredCommentCoordinate:null,changedClusterName:null},n.reloadCoordinatesWithSize=n.reloadCoordinatesWithSize.bind(Object(O.a)(n)),n.setSelectedCoordinates=n.setSelectedCoordinates.bind(Object(O.a)(n)),n.setClustersToShow=n.setClustersToShow.bind(Object(O.a)(n)),n.renameLabels=n.renameLabels.bind(Object(O.a)(n)),n.pushToDataChanged=n.pushToDataChanged.bind(Object(O.a)(n)),n.setHoveredCommentCoordinate=n.setHoveredCommentCoordinate.bind(Object(O.a)(n)),n.setChangedClusterName=n.setChangedClusterName.bind(Object(O.a)(n)),n}return Object(l.a)(a,[{key:"setChangedClusterName",value:function(e){this.setState({changedClusterName:e})}},{key:"setHoveredCommentCoordinate",value:function(e){if(e){if(this.state.allCoordinatesFull){var t=this.state.allCoordinatesFull[this.state.coordinatesParameters.numNeighborsParameter][this.state.coordinatesParameters.minDistParameter];this.setState({hoveredCommentCoordinate:t[e]})}}else this.setState({hoveredCommentCoordinate:null})}},{key:"pushToDataChanged",value:function(e){var t=x.find(this.state.dataChanged,["i",e.i]),a=x.without(this.state.dataChanged,t),n=t&&t.oldLabel.label_kmedoids==e.newLabel.label_kmedoids,r=!t&&e.oldLabel.label_kmedoids==e.newLabel.label_kmedoids;if(n&&!r||a.push(e),!this.state.clusters[e.newLabel.label_kmedoids]){var i=Object(g.a)({},this.state.clusters);i[e.newLabel.label_kmedoids]={medoid:null,representatives:[],size:1,quality:-1},this.setState({clusters:i})}this.setState({dataChanged:a})}},{key:"renameLabels",value:function(e,t){var a,n=this,r=this.state.clustersToShow.map((function(a,n){return e.includes(a)?t:a})),i=this.state.labels.map((function(a){return e.includes(a.label_kmedoids)?{label_kmedoids:t}:a})),s=x.cloneDeep(this.state.clusters),o=!1,l=Object(f.a)(e);try{for(l.s();!(a=l.n()).done;){var c=a.value;if(c!=t)s[t]?(o=!0,s[t]={medoid:s[t].medoid,representatives:[].concat(Object(p.a)(s[c].representatives),Object(p.a)(s[t].representatives)),size:s[c].size+s[t].size,quality:-1}):s[t]=Object(g.a)({},this.state.clusters[c]),delete s[c]}}catch(u){l.e(u)}finally{l.f()}var d=this.state.dataChanged.map((function(a){return e.includes(a.oldLabel.label_kmedoids)?Object(g.a)(Object(g.a)({},a),{},{oldLabel:{label_kmedoids:t}}):a})).map((function(a){return e.includes(a.newLabel.label_kmedoids)?Object(g.a)(Object(g.a)({},a),{},{newLabel:{label_kmedoids:t}}):a}));this.setState({clustersToShow:r,labels:i,clusters:s,dataChanged:d},(function(){o&&n.calc_quality()}))}},{key:"updateSelectedCoordinates",value:function(e){var t=this;if(!this.state.allCoordinatesFull)throw Error("allCoordinates is null");var a,n=this.state.coordinatesParameters.numNeighborsParameter,r=this.state.coordinatesParameters.minDistParameter;this.state.allCoordinates?a=this.state.allCoordinates.map((function(e){return t.state.allCoordinatesFull[n][r][e.index]})):a=this.getRandomIndices(this.state.labels||[],this.state.coordinates_to_show).map((function(e){return t.state.allCoordinatesFull[n][r][e]}));this.setState({allCoordinates:a},e)}},{key:"setClustersToShow",value:function(e,t){this.setState({clustersToShow:e})}},{key:"_getAllSelectedCoordinates",value:function(){if(!this.state.allCoordinatesFull)return console.log("allCoordinatesFull is null"),[];var e=this.state.coordinatesParameters.numNeighborsParameter,t=this.state.coordinatesParameters.minDistParameter;return this.state.allCoordinatesFull[e][t]||[]}},{key:"setSelectedCoordinates",value:function(e,t){this.setState({coordinatesParameters:{numNeighborsParameter:e,minDistParameter:t}},this.updateSelectedCoordinates)}},{key:"scaleEmbeddings",value:function(e){var t=e.map((function(e){return Math.abs(e.x)})),a=e.map((function(e){return Math.abs(e.y)})),n=x.max(t)||0,r=x.max(a)||0,i=Math.max(n,r),s=C.a().domain([-i,i]).range([0,100]);return e.map((function(e){return{x:s(e.x),y:s(e.y),index:e.index}}))}},{key:"getRandomIndices",value:function(e,t){var a=Array.from(Array(e.length).keys());if(t>3*a.length/5)return a;var n=new Array(t),r=a.length,i=new Array(r);if(t>r)throw new RangeError("getRandom: more elements taken than available");for(;t--;){var s=Math.floor(Math.random()*r);n[t]=a[s in i?i[s]:s],i[s]=--r in i?i[r]:r}return n}},{key:"loadCoordinates",value:function(){var e=Object(j.a)(v.a.mark((function e(t){var a,n,r,i=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={2:{.1:null,.2:null,.5:null,.9:null},5:{.1:null,.2:null,.5:null,.9:null},10:{.1:null,.2:null,.5:null,.9:null},50:{.1:null,.2:null,.5:null,.9:null}},n=Object.keys(a).flatMap((function(e){return Object.keys(a[2]).map((function(t){return[e,t]}))})),r=n.map((function(e){var t=e[0],n=e[1];return fetch("".concat("/interface-for-text-exploration-and-annotation","/coordinates/coordinates_supervised.").concat(t,".").concat(n,".json")).then((function(e){return e.json()})).then((function(e){var r=i.scaleEmbeddings(e);return a[t][n]=r,!0}))})),e.next=5,Promise.all(r);case 5:return e.abrupt("return",this.setState({allCoordinatesFull:a},this.calc_quality));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reloadCoordinatesWithSize",value:function(){var e=Object(j.a)(v.a.mark((function e(t,a){var n,r,i,s,o,l,c,d=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t>.8*((null===(n=this.state.data)||void 0===n?void 0:n.length)||0)?(null===(r=this.state.data)||void 0===r?void 0:r.length)||0:t,s=this.state.coordinatesParameters.numNeighborsParameter,o=this.state.coordinatesParameters.minDistParameter,l=this.getRandomIndices(this.state.labels||[],i),c=l.map((function(e){return d.state.allCoordinatesFull[s][o][e]})),this.setState({coordinates_to_show:i,allCoordinates:c});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadDataAndSearchIndex",value:function(){var e=Object(j.a)(v.a.mark((function e(){var t,a,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/interface-for-text-exploration-and-annotation","/data.json"));case 2:return t=e.sent,e.t0=JSON,e.next=6,t.text();case 6:e.t1=e.sent,(a=e.t0.parse.call(e.t0,e.t1)).forEach((function(e,t){e.i=t})),n=k()((function(){this.field("comment"),this.field("author"),this.field("published");for(var e=0;e<a.length;e++)this.add({comment:a[e].cleaned,author:a[e].authorName,published:a[e].publishedAt,id:"".concat(e)})})),this.setState({data:a,searchIndex:n});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadLabels",value:function(){var e=Object(j.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/interface-for-text-exploration-and-annotation","/labels.json"));case 2:return t=e.sent,e.t0=JSON,e.next=6,t.text();case 6:e.t1=e.sent,a=(a=e.t0.parse.call(e.t0,e.t1)).map((function(e){return{label_kmedoids:"cluster ".concat(e.label_kmedoids)}})),this.setState({labels:a});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_normalize_clusters",value:function(e){var t=0;for(var a in e)t=e[a].quality>t?e[a].quality:t;var n=C.a().domain([0,t]).range([0,1]);for(var r in e)e[r].quality=n(e[r].quality)}},{key:"calc_quality",value:function(){var e=this,t=Object(g.a)({},this.state.clusters),a=function(a){if(!t[a].medoid)return{v:void 0};var n=e._getAllSelectedCoordinates(),r=n[t[a].medoid],i=n.map((function(t){var n;if((null===(n=e.state.labels)||void 0===n?void 0:n[t.index].label_kmedoids)==a)return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))}));t[a].quality=x.mean(i)};for(var n in t){var r=a(n);if("object"===typeof r)return r.v}this._normalize_clusters(t),this.setState({clusters:t})}},{key:"loadClusters",value:function(){var e=Object(j.a)(v.a.mark((function e(){var t,a,n,r,i,s,o,l,c,d,u=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/interface-for-text-exploration-and-annotation","/cluster-representatives.json"));case 2:return t=e.sent,e.t0=JSON,e.next=6,t.text();case 6:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.next=10,fetch("".concat("/interface-for-text-exploration-and-annotation","/medoids.json"));case 10:return n=e.sent,e.t2=JSON,e.next=14,n.text();case 14:for(s in e.t3=e.sent,r=e.t2.parse.call(e.t2,e.t3),i={},a)o="cluster ".concat(s),i[o]={medoid:r[parseInt(s)].medoids_indices,representatives:a[parseInt(s)],size:0,quality:0};l=Object(f.a)(this.state.labels);try{for(l.s();!(c=l.n()).done;)d=c.value,i[d.label_kmedoids].size+=1}catch(h){l.e(h)}finally{l.f()}this.setState({clusters:i},(function(){return u.calc_quality()}));case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(j.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.loadCoordinates(this.state.coordinates_to_show),this.loadDataAndSearchIndex(),this.loadLabels()]);case 2:return e.next=4,this.setSelectedCoordinates(this.state.coordinatesParameters.numNeighborsParameter,this.state.coordinatesParameters.minDistParameter);case 4:return e.next=6,this.loadClusters();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(g.a)(Object(g.a)({},this.state),{},{reloadCoordinatesWithSize:this.reloadCoordinatesWithSize,setSelectedCoordinates:this.setSelectedCoordinates,setClustersToShow:this.setClustersToShow,renameLabels:this.renameLabels,pushToDataChanged:this.pushToDataChanged,setHoveredCommentCoordinate:this.setHoveredCommentCoordinate,setChangedClusterName:this.setChangedClusterName});return this.state.allCoordinates&&this.state.data&&this.state.labels&&this.state.clusters?Object(n.jsx)(tt,Object(g.a)({},e)):Object(n.jsx)("div",{style:{padding:"1rem"},children:"Loading data..."})}}]),a}(r.Component),nt=Object(u.a)(Object(h.a)({palette:{type:"dark",secondary:{main:"rgba(255, 255, 255, 1)",dark:"rgba(255, 255, 255, 1)",light:"rgba(255, 255, 255, 1)"},primary:{main:"rgba(255, 255, 255, 1)",dark:"rgba(255, 255, 255, 1)",light:"rgba(255, 255, 255, 1)"},background:{paper:"#303030"}},overrides:{MuiTableRow:{root:{"&$selected":{backgroundColor:"rgba(255, 255, 255, 0.15)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}}}}})),rt=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsx)(b.a,{theme:nt,children:Object(n.jsx)(at,{})})}}]),a}(r.Component);s.a.render(Object(n.jsx)(rt,{}),document.getElementById("root"))}},[[192,1,2]]]);
//# sourceMappingURL=main.2b4f7320.chunk.js.map